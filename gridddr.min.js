!function(e){e.gridddr=function(t){return e("body").gridddr(t,!0)},e.fn.gridddr=function(t,a){var i={debug:!1,relative:!1,container:null,itemClass:!1,itemTag:"img",defaultClasses:{container:".gridddr-container",item:".gridddr-item",overlay:".gridddr-overlay",nowrap:".gridddr-nowrap-container",invisible:".gridddr-invisible",separator:".gridddr-separator",fitImage:".fit-image",scrollable:".gridddr-non-scrollable",imgPlaceholder:".loaded-image",slideUp:".gridddr-slideup",flipper:{flipFront:".gridddr-flipper-front",flipBack:".gridddr-flipper-back",flipWrapper:".gridddr-flipper",flipContainer:".gridddr-flip-container",opened:"opened"}},scrollableContainer:!1,fitContainer:!1,fitImage:!1,saveNode:!1,itemWidth:150,itemHeight:150,preloading:!0,useQueue:!0,shuffleQueue:!0,queueDelay:50,overlay:!0,overlayOpacity:.6,gridX:!1,gridY:!1,repeat:!0,useGPU:!0,animations:!0,animationType:"fade",animationsSpeed:1e3,events:{}},r={window:{resize:function(){e(n.defaultClasses.container).each(function(t,a){s.updateGrid(e(a),s.findGridddrItems(n.saveNode?e(a):e(a).find(n.defaultClasses.item)))})}},container:{inititalized:function(){startTime=(new Date).getTime()},finished:function(e,t){s.debug("Gridddr finished loading in "+t/1e3)}},item:{mouseover:function(){},mouseout:function(){}}},n=e.extend(!0,i,t),s={findGridddrItems:function(e){var t=n.itemTag&&n.itemClass?n.itemTag+n.itemClass:!1||n.itemTag||n.itemClass||"*";return s.debug("Looking for:",t),e.find(">"+t)},generateWrapper:function(t){var a;switch(n.animationType.toLowerCase()){case"flip":a=t.wrap(e("<div/>",{"class":n.defaultClasses.flipper.flipFront.slice(1)})).parent().wrap(e("<div/>",{"class":n.defaultClasses.flipper.flipWrapper.slice(1)})).parent().append(e("<div/>",{"class":n.defaultClasses.flipper.flipBack.slice(1)})).wrap(e("<div/>",{"class":n.defaultClasses.flipper.flipContainer.slice(1)})).parent();break;default:a=t.wrap(e("<div/>",{"class":n.defaultClasses.item.slice(1)})).parent()}return a},wrapItems:function(t){var a=s.findGridddrItems(t);return a.size()>0&&a.each(function(){var t=n.saveNode?e(this):s.generateWrapper(e(this));n.preloading&&s.prepareForPreloading(t),n.fitImage&&t.addClass(n.defaultClasses.fitImage.slice(1)),n.defaultClasses.item&&!t.hasClass(n.defaultClasses.item.slice(1))&&t.addClass(n.defaultClasses.item.slice(1)),n.itemWidth&&t.width(Number(n.itemWidth)),n.itemHeight&&t.height(Number(n.itemHeight))}),s.createGrid(t,a)},setRelativeClass:function(e,t){var t=t||n.relative||!1;return t?e.addClass("relative"):e.removeClass("relative"),!0},grepItemsByEq:function(t,a){return e.grep(t,function(e,t){return(t+1)%Number(a)==0})},createGrid:function(t,a){return t.addClass(n.defaultClasses.nowrap.slice(1)),n.scrollableContainer||t.addClass(n.defaultClasses.scrollable.slice(1)),t.each(function(){s.updateGrid(e(this),a)}),!0},updateGrid:function(t,a){if(s.removeSeparators(),n.gridX&&"number"==typeof n.gridX&&Number(n.gridX)>0){var a=s.grepItemsByEq(a,n.gridX);e.each(a,s.insertSeparator)}else if("number"==typeof n.itemWidth){var i=t.width()/n.itemWidth||10;i=n.fitContainer?Math.floor(i):Math.ceil(i),e.each(s.grepItemsByEq(a,i),s.insertSeparator)}return!0},removeSeparators:function(){return e(n.defaultClasses.separator).remove()},insertSeparator:function(t,a){var i=e(a);if(!n.saveNode)switch(n.animationType){case"flip":i=i.parents().eq(2);break;default:i=i.parent()}return e("<div/>",{"class":n.defaultClasses.separator.slice(1)}).insertAfter(i),!0},overlay:function(t){if(0!=n.overlay){var a=e(t.find(n.defaultClasses.overlay).get(0)||t.prepend(e("<div/>",{"class":n.defaultClasses.overlay.slice(1)})).find(n.defaultClasses.overlay).get(0));"true"!=n.overlay.toString()&&s.css(a,"background-color",n.overlay.toString()),"number"==typeof n.overlayOpacity?s.css(a,"opacity",Number(n.overlayOpacity)):"boolean"==typeof n.overlayOpacity&&s.css(a,"opacity",Math.min(.8,Number(n.overlayOpacity)))}return!0},prepareForPreloading:function(e){switch(n.saveNode&&"flip"==n.animationType.toLowerCase()&&(n.animationType="fade"),n.animationType.toLowerCase()){case"flip":e.addClass(n.defaultClasses.flipper.opened);break;default:e.addClass(n.defaultClasses.invisible.slice(1)),"slide"===n.animationType.toLowerCase()&&e.addClass(n.defaultClasses.slideUp.slice(1))}return!0},loadImage:function(e,t,a,i){e.attr("src",a).removeData("src"),n.preloading&&e.addClass(n.defaultClasses.imgPlaceholder.slice(1)),n.useQueue?(i.push(e),i.length==t&&s.queuePromise.resolve()):s.loadedCallback.apply(e)},preloadContent:function(t){var a=e(t).find(n.defaultClasses.item),i=this.queue,r=a.size();if(n.saveNode||(a=a.find("[data-src]")),n.preloading&&r>0)try{a.each(function(){var t=e(this),a=t.data("src");e("<img>").attr("src",a).one("load",function(){s.loadImage(t,r,a,i)}).on("error",function(t){s.debug("Error while loading image: ",t,e(t.delegateTarget))})})}catch(l){s.queuePromise.reject(l)}else a.each(function(){s.loadImage(e(this),r,e(this).data("src"),i)});return!0},loadedCallback:function(){if(n.preloading)switch(n.animationType.toLowerCase()){case"flip":return e(this).removeClass(n.defaultClasses.imgPlaceholder.slice(1)).parents().eq(2).removeClass(n.defaultClasses.flipper.opened);default:var t=e(this).removeClass(n.defaultClasses.imgPlaceholder.slice(1));return n.saveNode||(t=t.parent()),"slide"===n.animationType.toLowerCase()&&t.removeClass(n.defaultClasses.slideUp.slice(1)),t.removeClass(n.defaultClasses.invisible.slice(1))}},createQueue:function(){return this.queue=[],this.queuePromise=e.Deferred(),this.queuePromise.done(this.execQueue),this.queuePromise.fail(function(t){s.debug("Preloading images failed: ",t),this.queue.length>0&&this.execQueue(this.queue),($images=e(n.defaultClasses.container).find(n.defaultClasses.item).find("[data-src]")&&$images.size()>0)&&$images.each(s.loadedCallback)}),this.queue},shuffleQueue:function(e){for(var t,a,i=e.length;i;)a=Math.floor(Math.random()*i--),t=e[i],e[i]=e[a],e[a]=t;return e},execQueue:function(t){var t=t||s.queue;n.shuffleQueue&&(t=s.shuffleQueue(t)),e.each(t,function(a){var i=e(this);setTimeout(function(){s.loadedCallback.apply(i),a==t.length-1&&s.eventTrigger("finished","container",(new Date).getTime()-startTime)},a*Number(n.queueDelay))})},eventTrigger:function(e,t){var e=e.toLowerCase(),t=t.toLowerCase(),a=s.defineEventContext(t);return s.debug("Event triggered: ",e,"in",t,"context."),r[t][e]?a.trigger.apply(a,[e,Array.prototype.slice.call(arguments,2)]):!1},defineEventContext:function(t,a){var i,a=a||e(n.defaultClasses.container);switch(t.toString().toLowerCase()){case"window":i=e(window);break;case"item":i=a.find(n.defaultClasses.item);break;default:i=a}return i},bindEvents:function(t){var a;return n.events&&"object"==typeof n.events&&(r=e.extend(!0,r,n.events)),e.each(r,function(i,r){a=s.defineEventContext(i,t),e.each(r,function(e,t){var i=""===t.toString().match(/\{([\s\S]*)\}/m)[1].replace(/^\s*\/\/.*$/gm,"").trim()?"empty function on "+e:"on "+e;s.debug("Binding",i,"to",{elements:a}),"function"==typeof t&&null!==t&&a.bind(e,t)})})},inititalize:function(t,a){var i=e(a);return i.css("opacity",0),n.events&&n.events.beforeInit&&"function"==typeof n.events.beforeInit&&n.events.beforeInit.call(),i.hasClass(n.defaultClasses.container.slice(1))||i.addClass(n.defaultClasses.container.slice(1)),n.relative&&s.setRelativeClass(i,!0),s.overlay(i)&&s.wrapItems(i)&&!i.data("inititalized")?(s.bindEvents(i),n.useQueue&&s.createQueue.apply(s),s.preloadContent.apply(s,i),i.data("inititalized",!0).css("opacity",1),s.eventTrigger("inititalized","container"),s.debug(a,"inititalized as Gridddr."),!0):(s.debug("Something went wrong"),!1)},css:function(e,t,a,i){if(n.animations){if("object"!=typeof t){var r=t;t={},t[r]=a,delete r,delete a}e.animate(t,n.animationsSpeed||0,i||!1)}else e.css(t,a||!1),"function"==typeof i?i.call():"function"==typeof window[i]?window[i]():s.debug(i,"function dows not exist.");return!0},debug:function(){return n.debug&&console?(console.log.apply(console,arguments),!0):!1}},l={getSettings:function(){return n},updateSettings:function(e){n=e,l.refresh()},refresh:function(e){},getBindedEvents:function(){var t={};return e.each(r,function(a){var i=e(s.defineEventContext(a,!1)),r=e._data(i.get(0),"events");return r?void(t[a]=e.map(r,function(e,t){var a={name:e,body:t};return a})):(s.debug("There are no events or they are not loaded yet."),t=!1,!1)}),t},getItems:function(){return e(this).find(n.defaultClasses.item)}};return e.extend(!0,this,l),e.each(this,s.inititalize)}}(jQuery);