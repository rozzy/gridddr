!function(e){e.gridddr=function(a){return e("body").gridddr(a,!0)},e.fn.gridddr=function(a,i){var t={debug:!1,relative:!1,container:null,itemClass:!1,itemTag:"img",defaultClasses:{container:".gridddr-container",item:".gridddr-item",overlay:".gridddr-overlay",invisible:".gridddr-invisible",fitImage:".fit-image",flipper:{flipFront:".gridddr-flipper-front",flipBack:".gridddr-flipper-back",flipWrapper:".gridddr-flipper",flipContainer:".gridddr-flip-container",opened:"opened"}},fitImage:!1,saveNode:!1,itemWidth:150,itemHeight:150,preloading:!0,useQueue:!0,shuffleQueue:!0,queueDelay:10,overlay:!0,overlayOpacity:!0,gridX:!1,gridY:!1,repeat:!0,useGPU:!0,animations:!0,animationType:"flip",animationsSpeed:1e3},s=e.extend(t,a),r={findGridddrItems:function(e){var a=s.itemTag&&s.itemClass?s.itemTag+s.itemClass:!1||s.itemTag||s.itemClass||"*";return r.debug("Looking for:",a),e.find(">"+a)},generateWrapper:function(a){var i;switch(s.animationType){case"flip":i=a.wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipFront.slice(1)})).parent().wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipWrapper.slice(1)})).parent().append(e("<div/>",{"class":s.defaultClasses.flipper.flipBack.slice(1)})).wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipContainer.slice(1)})).parent();break;default:i=a.wrap(e("<div/>",{"class":s.defaultClasses.item.slice(1)})).parent()}return i},wrapItems:function(a){var i=r.findGridddrItems(a);return i.size()>0&&i.each(function(){var a=s.saveNode?e(this):r.generateWrapper(e(this));s.preloading&&r.prepareForPreloading(a),s.fitImage&&a.addClass(s.defaultClasses.fitImage.slice(1)),s.defaultClasses.item&&!a.hasClass(s.defaultClasses.item.slice(1))&&a.addClass(s.defaultClasses.item.slice(1)),s.itemWidth&&a.width(Number(s.itemWidth)),s.itemHeight&&a.height(Number(s.itemHeight))}),r.createGrid(a,i)},setRelativeClass:function(e,a){var a=a||s.relative||!1;return a?e.addClass("relative"):e.removeClass("relative"),!0},createGrid:function(){return!0},overlay:function(a){if(0!=s.overlay){var i=e(a.find(s.defaultClasses.overlay).get(0)||a.prepend(e("<div/>",{"class":s.defaultClasses.overlay.slice(1)})).find(s.defaultClasses.overlay).get(0));"true"!=s.overlay.toString()&&r.css(i,"background-color",s.overlay.toString()),"number"==typeof s.overlayOpacity?r.css(i,"opacity",Number(s.overlayOpacity)):"boolean"==typeof s.overlayOpacity&&r.css(i,"opacity",Math.min(.9,Number(s.overlayOpacity)))}return!0},css:function(e,a,i,t){if(s.animations){if("object"!=typeof a){var l=a;a={},a[l]=i,delete l,delete i}e.animate(a,s.animationsSpeed||0,t||!1)}else e.css(a,i||!1),"function"==typeof t?t.call():"function"==typeof window[t]?window[t]():r.debug(t,"function dows not exist.");return!0},prepareForPreloading:function(e){"fade"==s.animationType&&e.addClass(s.defaultClasses.invisible.slice(1)),"flip"==s.animationType&&e.addClass(s.defaultClasses.flipper.opened)},preloadContent:function(a){if(s.preloading){var i=e(a).find(s.defaultClasses.item).find("[data-src]"),t=this.queue,l=i.size();if(l>0)try{i.each(function(){var a=e(this),i=a.data("src");e("<img>").attr("src",i).one("load",function(){a.attr("src",i).removeData("src"),s.useQueue?(t.push(a),t.length==l-1&&r.queuePromise.resolve()):r.loadedCallback.apply(a)})})}catch(n){r.queuePromise.reject(n)}}return!0},loadedCallback:function(){switch(s.animationType){case"flip":return e(this).parents().eq(2).removeClass(s.defaultClasses.flipper.opened);default:return e(this).parent().removeClass(s.defaultClasses.invisible.slice(1))}},createQueue:function(){return this.queue=[],this.queuePromise=e.Deferred(),this.queuePromise.done(this.execQueue),this.queuePromise.fail(function(a){r.debug("Preloading images failed: ",a),this.queue.length>0&&this.execQueue(this.queue),($images=e(s.defaultClasses.container).find(s.defaultClasses.item).find("[data-src]")&&$images.size()>0)&&$images.each(r.loadedCallback)}),!0},shuffleQueue:function(e){for(var a,i,t=e.length;t;)i=Math.floor(Math.random()*t--),a=e[t],e[t]=e[i],e[i]=a;return e},execQueue:function(a){var a=a||r.queue;s.shuffleQueue&&(a=r.shuffleQueue(a)),e.each(a,function(a){var i=e(this);setTimeout(function(){r.loadedCallback.apply(i)},a*Number(s.queueDelay))})},debug:function(){return s.debug&&console?(console.log.apply(console,arguments),!0):!1},inititalize:function(a,i){var t=e(i);return t.hasClass(s.defaultClasses.container.slice(1))||t.addClass(s.defaultClasses.container.slice(1)),s.relative&&r.setRelativeClass(t,!0),r.overlay(t)&&r.wrapItems(t)&&!t.data("inititalized")?(s.useQueue&&r.createQueue.apply(r),r.preloadContent.apply(r,t),t.data("inititalized",!0),r.debug(i,"inititalized as Gridddr."),!0):(r.debug("Something went wrong"),!1)}},l={getSettings:function(){return s},setOverlayOpacity:function(a){var a=a||!!a;return s.overlayOpacity=a,r.overlay(e(s.container)),this}};return e.extend(this,l),e.each(this,r.inititalize),this}}(jQuery);