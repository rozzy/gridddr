!function(e){e.gridddr=function(a){return e("body").gridddr(a,!0)},e.fn.gridddr=function(a,t){var i={debug:!1,relative:!1,container:null,itemClass:!1,itemTag:"img",defaultClasses:{container:".gridddr-container",item:".gridddr-item",overlay:".gridddr-overlay",nowrap:".gridddr-nowrap-container",invisible:".gridddr-invisible",separator:".gridddr-separator",fitImage:".fit-image",scrollable:".gridddr-non-scrollable",imgPlaceholder:".loaded-image",slideUp:".gridddr-slideup",flipper:{flipFront:".gridddr-flipper-front",flipBack:".gridddr-flipper-back",flipWrapper:".gridddr-flipper",flipContainer:".gridddr-flip-container",opened:"opened"}},scrollableContainer:!1,fitContainer:!1,fitImage:!1,saveNode:!1,itemWidth:150,itemHeight:150,preloading:!0,useQueue:!0,shuffleQueue:!0,queueDelay:50,overlay:!0,overlayOpacity:.6,gridX:!1,gridY:!1,repeat:!0,useGPU:!0,animations:!0,animationType:"fade",animationsSpeed:1e3,events:{}},r={window:{resize:function(){e(s.defaultClasses.container).each(function(a,t){n.updateGrid(e(t),n.findGridddrItems(s.saveNode?e(t):e(t).find(s.defaultClasses.item)))})}},container:{inititalized:function(){},finished:function(){alert()}},item:{mouseover:function(){},mouseout:function(){}}},s=e.extend(i,a),n={findGridddrItems:function(e){var a=s.itemTag&&s.itemClass?s.itemTag+s.itemClass:!1||s.itemTag||s.itemClass||"*";return n.debug("Looking for:",a),e.find(">"+a)},generateWrapper:function(a){var t;switch(s.animationType.toLowerCase()){case"flip":t=a.wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipFront.slice(1)})).parent().wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipWrapper.slice(1)})).parent().append(e("<div/>",{"class":s.defaultClasses.flipper.flipBack.slice(1)})).wrap(e("<div/>",{"class":s.defaultClasses.flipper.flipContainer.slice(1)})).parent();break;default:t=a.wrap(e("<div/>",{"class":s.defaultClasses.item.slice(1)})).parent()}return t},wrapItems:function(a){var t=n.findGridddrItems(a);return t.size()>0&&t.each(function(){var a=s.saveNode?e(this):n.generateWrapper(e(this));s.preloading&&n.prepareForPreloading(a),s.fitImage&&a.addClass(s.defaultClasses.fitImage.slice(1)),s.defaultClasses.item&&!a.hasClass(s.defaultClasses.item.slice(1))&&a.addClass(s.defaultClasses.item.slice(1)),s.itemWidth&&a.width(Number(s.itemWidth)),s.itemHeight&&a.height(Number(s.itemHeight))}),n.createGrid(a,t)},setRelativeClass:function(e,a){var a=a||s.relative||!1;return a?e.addClass("relative"):e.removeClass("relative"),!0},grepItemsByEq:function(a,t){return e.grep(a,function(e,a){return(a+1)%Number(t)==0})},createGrid:function(a,t){return a.addClass(s.defaultClasses.nowrap.slice(1)),s.scrollableContainer||a.addClass(s.defaultClasses.scrollable.slice(1)),a.each(function(){n.updateGrid(e(this),t)}),!0},updateGrid:function(a,t){if(n.removeSeparators(),s.gridX&&"number"==typeof s.gridX&&Number(s.gridX)>0){var t=n.grepItemsByEq(t,s.gridX);e.each(t,n.insertSeparator)}else if("number"==typeof s.itemWidth){var i=a.width()/s.itemWidth||10;i=s.fitContainer?Math.floor(i):Math.ceil(i),e.each(n.grepItemsByEq(t,i),n.insertSeparator)}return!0},removeSeparators:function(){return e(s.defaultClasses.separator).remove()},insertSeparator:function(a,t){var i=e(t);if(!s.saveNode)switch(s.animationType){case"flip":i=i.parents().eq(2);break;default:i=i.parent()}return e("<div/>",{"class":s.defaultClasses.separator.slice(1)}).insertAfter(i),!0},overlay:function(a){if(0!=s.overlay){var t=e(a.find(s.defaultClasses.overlay).get(0)||a.prepend(e("<div/>",{"class":s.defaultClasses.overlay.slice(1)})).find(s.defaultClasses.overlay).get(0));"true"!=s.overlay.toString()&&n.css(t,"background-color",s.overlay.toString()),"number"==typeof s.overlayOpacity?n.css(t,"opacity",Number(s.overlayOpacity)):"boolean"==typeof s.overlayOpacity&&n.css(t,"opacity",Math.min(.8,Number(s.overlayOpacity)))}return!0},css:function(e,a,t,i){if(s.animations){if("object"!=typeof a){var r=a;a={},a[r]=t,delete r,delete t}e.animate(a,s.animationsSpeed||0,i||!1)}else e.css(a,t||!1),"function"==typeof i?i.call():"function"==typeof window[i]?window[i]():n.debug(i,"function dows not exist.");return!0},prepareForPreloading:function(e){switch(s.saveNode&&"flip"==s.animationType.toLowerCase()&&(s.animationType="fade"),s.animationType.toLowerCase()){case"flip":e.addClass(s.defaultClasses.flipper.opened);break;default:e.addClass(s.defaultClasses.invisible.slice(1)),"slide"===s.animationType.toLowerCase()&&e.addClass(s.defaultClasses.slideUp.slice(1))}return!0},loadImage:function(e,a,t,i){e.attr("src",t).removeData("src"),s.preloading&&e.addClass(s.defaultClasses.imgPlaceholder.slice(1)),s.useQueue?(i.push(e),i.length==a&&n.queuePromise.resolve()):n.loadedCallback.apply(e)},preloadContent:function(a){var t=e(a).find(s.defaultClasses.item),i=this.queue,r=t.size();if(s.saveNode||(t=t.find("[data-src]")),s.preloading&&r>0)try{t.each(function(){var a=e(this),t=a.data("src");e("<img>").attr("src",t).one("load",function(){n.loadImage(a,r,t,i)}).on("error",function(a){n.debug("Error while loading image: ",a,e(a.delegateTarget))})})}catch(l){n.queuePromise.reject(l)}else t.each(function(){n.loadImage(e(this),r,e(this).data("src"),i)});return!0},loadedCallback:function(){if(s.preloading)switch(s.animationType.toLowerCase()){case"flip":return e(this).removeClass(s.defaultClasses.imgPlaceholder.slice(1)).parents().eq(2).removeClass(s.defaultClasses.flipper.opened);default:var a=e(this).removeClass(s.defaultClasses.imgPlaceholder.slice(1));return s.saveNode||(a=a.parent()),"slide"===s.animationType.toLowerCase()&&a.removeClass(s.defaultClasses.slideUp.slice(1)),a.removeClass(s.defaultClasses.invisible.slice(1))}},createQueue:function(){return this.queue=[],this.queuePromise=e.Deferred(),this.queuePromise.done(this.execQueue),this.queuePromise.fail(function(a){n.debug("Preloading images failed: ",a),this.queue.length>0&&this.execQueue(this.queue),($images=e(s.defaultClasses.container).find(s.defaultClasses.item).find("[data-src]")&&$images.size()>0)&&$images.each(n.loadedCallback)}),this.queue},shuffleQueue:function(e){for(var a,t,i=e.length;i;)t=Math.floor(Math.random()*i--),a=e[i],e[i]=e[t],e[t]=a;return e},execQueue:function(a){var a=a||n.queue;s.shuffleQueue&&(a=n.shuffleQueue(a)),e.each(a,function(t){var i=e(this);setTimeout(function(){n.loadedCallback.apply(i),t==a.length-1&&n.eventTrigger("finished","container")},t*Number(s.queueDelay))})},eventTrigger:function(e,a){var e=e.toLowerCase(),a=a.toLowerCase(),t=n.defineEventContext(a);return n.debug("Event triggered: ",e,"in",a,"context."),r[a][e]?t.trigger.apply(t,[e,Array.prototype.slice.call(arguments,2)]):!1},debug:function(){return s.debug&&console?(console.log.apply(console,arguments),!0):!1},defineEventContext:function(a,t){var i,t=t||e(s.defaultClasses.container);switch(a.toString().toLowerCase()){case"window":i=e(window);break;case"item":i=t.find(s.defaultClasses.item);break;default:i=t}return i},bindEvents:function(a){var t;return s.events&&"object"==typeof s.events&&(r=e.extend(r,s.events)),e.each(r,function(i,r){t=n.defineEventContext(i,a),e.each(r,function(e,a){n.debug("Binding",e,"to",{elements:t}),"function"==typeof a&&null!==a&&t.bind(e,a)})})},inititalize:function(a,t){var i=e(t);return i.css("opacity",0),s.events&&s.events.beforeInit&&"function"==typeof s.events.beforeInit&&s.events.beforeInit.call(),i.hasClass(s.defaultClasses.container.slice(1))||i.addClass(s.defaultClasses.container.slice(1)),s.relative&&n.setRelativeClass(i,!0),n.overlay(i)&&n.wrapItems(i)&&!i.data("inititalized")?(n.bindEvents(i),s.useQueue&&n.createQueue.apply(n),n.preloadContent.apply(n,i),i.data("inititalized",!0).css("opacity",1),n.eventTrigger("inititalized","container","lol"),n.debug(t,"inititalized as Gridddr."),!0):(n.debug("Something went wrong"),!1)}},l={getSettings:function(){return s},setOverlayOpacity:function(a){var a=a||!!a;return s.overlayOpacity=Number(a),n.overlay(e(s.defaultClasses.container)),this},getBindedEvents:function(a){var t=a||e(this),i=e._data(t.get(0),"events");if(!i)return!1;var r=e.map(i,function(e,a){var t={name:e,body:a};return t});return n.debug("There are",r?r.length:0,"events binded to",t.get(0).tagName+(t.attr("id")?"#"+t.attr("id"):"")+(t.attr("class")?"."+t.attr("class").replace(/\s+/g,"."):""),":\n",r),r},getItems:function(){return e(this).find(s.defaultClasses.item)}};return e.extend(this,l),e.each(this,n.inititalize)}}(jQuery);